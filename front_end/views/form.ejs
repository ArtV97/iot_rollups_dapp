<!DOCTYPE html>
<html>

<head lang="pt-br">
	<title>Cartesi Rollups Dapp</title>
	<meta charset="utf-8">

    <!-- Bootstrap -->
	<link href="bootstrap-5.1.3-dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Font Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
</head>

<body id="home" style="padding-top: 70px;">

    <nav class="navbar navbar-light bg-light navbar-expand-md fixed-top border-bottom">
		<div class="container position-relative">
           <a class="navbar-brand" href="/">
               <img src="assets/images/logo.png" style="height: 48px;" alt="IoT Rollups DApp">
            </a>

            <!-- <div class="collapse navbar-collapse"> -->
            <ul class="navbar-nav position-absolute top-50 start-50 translate-middle">
                <li class="nav-item">
                    <a class="nav-link" aria-current="Dashboard" href="/">Dashboard</a>
                </li>

                <li class="nav-item">
                <a class="nav-link active disabled" aria-current="Form" href="">Form</a>
                </li>
            </ul>
    
            <!-- </div> -->
        </div>
    </nav>

    <div class="container mt-4">
        <form>
            <!-- <div class="mb-3">
                <label for="selectedAddress" class="form-label">From Address</label>
                <select id="selectedAddress" class="form-select">
                  <option selected value=""> Choose Address</option>
                  <% //for (var i = 1; i < accounts.length; i++) { %>
                    <option>
                            <%= //accounts[i] %>
                    </option>
                    <% //} %>
                </select>
            </div> -->
   
            <div class="mb-3">
                <label for="scheduleFile" class="form-label">Load Schedule From JSON file</label>
                <input class="form-control" type="file" accept=".json" id="scheduleFile" onchange="loadFileContent()">
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-primary text-center" onclick="formSubmit()">Submit</button>
            </div>
        </form>
    </div>
</body>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script>
    function loadFileContent(){
        var fileToLoad = document.getElementById("scheduleFile").files[0];

        var fileReader = new FileReader();
        fileReader.onload = function(fileLoadedEvent){
            textFromFileLoaded = fileLoadedEvent.target.result;
            //console.log(textFromFileLoaded)
        };

        fileReader.readAsText(fileToLoad, "UTF-8");
    }

 
    function formSubmit() {
        //const fromAddress = document.getElementById("selectedAddress").value
        let body = undefined

        // if (fromAddress == "") {
        //     alert("Error: Please select an Address.")
        //     return
        // }

        if (textFromFileLoaded) {
            try {
                let json = JSON.parse(textFromFileLoaded)
                body = JSON.stringify(json)
            }
            catch (error) {
                alert(error)
                return
            }
        }

        if (!body) {
            alert("Error: Nothing to send.")
            return
        }

        $.ajax({
            url:"/submit",
            type: "POST",
            async: false,
            data: body,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            // data : {
            //     fromAddress: document.getElementById("selectedAddress").value,
            //     data: body
            // },
            cache : false,
            success : function (res) {
                if(res["success"]){
                    alert(res["result"]);
                }
                else if (!res["success"]) {
                    alert(res["result"])
                }
            },
            error : function () {
                // some error handling part
                alert("Request Failed");
            }
        });
    };
</script>
</html>